<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Go/Gin Gower 是一个基于 Go 语言和 Gin 框架的项目.">
<meta name="author" content="falling-ts">

<title>异常 · Go/Gin Gower 文档</title>

<link rel="canonical" href="../../single/%E5%BC%82%E5%B8%B8/">









<link rel="stylesheet" href="../../scss/base.css" integrity="">



<link rel="stylesheet" href="../../scss/theme/default.css" integrity="">



<link rel="manifest" href="../../manifest.json">
<link rel="icon" href="../../img/icon/favicon.ico">
<link rel="icon" href="../../img/icon/icon-16.png" sizes="16x16" type="image/png">
<link rel="icon" href="../../img/icon/icon-32.png" sizes="32x32" type="image/png">
<link rel="apple-touch-icon" href="../../img/icon/icon-180.png" sizes="180x180">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-00000000"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-00000000');
</script>


  

  </head>
  <body>
    <header id="site-header">
  
  <div id="site-header-brand">
    <a href="../../">Go/Gin Gower 文档</a>
  </div>

  
  <div id="site-header-controls">
    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="theme selector">
        <i class="icon icon-brightness"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        <li role="menuitem"><button class="color-scheme" data-value="light"><i class="icon icon-light-mode"></i> Light</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="dark"><i class="icon icon-dark-mode"></i> Dark &nbsp;</button></li>
        <li role="menuitem"><button class="color-scheme" data-value="night"><i class="icon icon-night-mode"></i> Night</button></li>
      </ul>
    </div>

    
    <div class="dropdown">
      <button class="dropdown-btn" aria-haspopup="menu" aria-label="language selector">
        <i class="icon icon-translate"></i>
        <i class="icon icon-select"></i>
      </button>
      <ul role="menu" class="dropdown-menu">
        
          
          <li role="menuitem"><a href="../../single/%E5%BC%82%E5%B8%B8/">中文</a></li>
          
          <li role="menuitem"><a href="../../en/single/exceptions/">English</a></li>
          
        
      </ul>
    </div>
  </div>

  
  <div id="site-header-menu">
    <nav>
      <ul>
        
        
        
          
          <li><a href="../../" ><svg t="1731853730249" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="883" width="200" height="200"><path d="M466.48888853 821.99893333A182.13546667 182.13546667 0 0 1 512 463.64444479a182.0444448 182.0444448 0 0 1 45.51111147 358.35448854V918.75555519h227.5555552v-364.08888853a45.51111147 45.51111147 0 0 1 45.51111146-45.51111147h17.93137707L512 206.27911146 175.4908448 509.15555519H193.42222187a45.51111147 45.51111147 0 0 1 45.51111146 45.51111147v364.08888853h91.02222187a45.51111147 45.51111147 0 0 1 0 91.02222294H193.42222187a45.51111147 45.51111147 0 0 1-45.5111104-45.51111147v-364.08888853H56.88888853c-41.68817813 0-61.44-51.4275552-30.44693333-79.32586667l455.11111147-409.6a45.51111147 45.51111147 0 0 1 60.89386666 0l455.11111147 409.6C1028.55111147 548.75022186 1008.79928853 600.17777813 967.11111147 600.17777813h-91.02222294v364.08888853a45.51111147 45.51111147 0 0 1-45.5111104 45.51111147h-318.57777813a45.51111147 45.51111147 0 0 1-45.51111147-45.51111147v-142.26773333zM512 736.71111146a91.02222187 91.02222187 0 1 0 0-182.0444448 91.02222187 91.02222187 0 0 0 0 182.0444448z" fill="#2c2c2c" p-id="884"></path></svg>首页</a></li>
        
          
          <li><a href="../../workspace/%E4%BB%8B%E7%BB%8D/" ><svg t="1731853749882" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1030" width="200" height="200"><path d="M941.48136843 320.91117833a58.73434594 58.73434594 0 0 0-29.56686-50.74309969L546.72469031 61.2022452a58.73434594 58.73434594 0 0 0-58.73434594 1e-8l-363.59044406 211.76239406a58.73434594 58.73434594 0 0 0-28.76811094 51.14247468v420.72729094a58.73434594 58.73434594 0 0 0 29.56592344 50.74309969l363.59231906 208.16614594a58.73434594 58.73434594 0 0 0 58.33403344 0l365.18981812-210.9627075a58.73434594 58.73434594 0 0 0 29.56686-51.14247469zM516.75939281 122.73315177l307.65453375 176.20303781-141.84086625 90.69745406-134.24993344-76.71371156a59.93247001 59.93247001 0 0 0-59.9315325 0L353.74134843 392.8305177l-142.24024125-91.4971425z m0 567.76284281l-119.86494094-69.12184125 114.27181875-70.72121437L623.43746437 630.56352364zM382.11008437 453.96111177l105.480885-61.53090656v105.48182249a25.17186281 25.17186281 0 0 0 0 2.79656063h-4.39499719l-100.68745031 64.32840562z m161.81804437 44.35029094V388.83489458l112.27400719 63.12840563V581.41792302L542.72812967 501.50827583a27.56904844 27.56904844 0 0 0 2e-8-4.79437312zM163.55550562 351.27678833l150.6308625 95.49276469v170.60803968a59.93247001 59.93247001 0 0 0 29.96623501 51.54278719l140.64180561 79.90964813v173.00616375l-319.64046561-183.39365907z m389.56199344 570.9587775V749.23033958l141.44055468-79.90964719a59.93247001 59.93247001 0 0 0 29.9671725-51.94216219V445.57049146l150.23148844-95.09245313V737.6428452z m0 0" fill="#2c2c2c" p-id="1031"></path></svg>工作区模式</a></li>
        
          
          <li><a href="../../single/%E5%89%8D%E8%A8%80/" ><svg t="1731853765799" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1314" width="200" height="200"><path d="M512 57.5822816c-262.31427627 0-475.75105173 213.43493973-475.75105173 475.75105173 0 262.3491392 213.40191147 475.75105173 475.75105173 475.75105173S987.75105173 795.68247253 987.75105173 533.33333333C987.75105173 271.01905706 774.3491392 57.5822816 512 57.5822816zM512 940.8177184c-224.6992608 0-407.48438507-182.81815147-407.48438507-407.48438507 0-224.6992608 182.78328853-407.48438507 407.48438507-407.48438507 224.66623253 0 407.48438507 182.78328853 407.48438507 407.48438507C919.48438507 757.99956586 736.66623253 940.8177184 512 940.8177184z" fill="#2c2c2c" p-id="1315"></path><path d="M512 362.667584c-94.1054304 0-170.667584 76.56031893-170.667584 170.66574933s76.56031893 170.667584 170.667584 170.667584 170.667584-76.56031893 170.667584-170.667584S606.1054304 362.667584 512 362.667584z" fill="#2c2c2c" p-id="1316"></path></svg>单项目模式</a></li>
        
      </ul>
    </nav>
  </div>

  
  <div id="site-header-search"></div>
</header>
    
<div id="site-main-content-wrapper">
  
  
    


<aside id="sidebar">
  <span class="btn-close"><i class="icon icon-close"></i></span>

  <div class="sticky"><strong class="sidebar-section">介绍</strong>
          
          <a id="zh-0-0" class="sidebar-link " href="../../single/%E5%89%8D%E8%A8%80/#zh-0-0">
            
              前言
            
          </a>

        
          
          <a id="zh-0-1" class="sidebar-link " href="../../single/%E5%AE%89%E8%A3%85/#zh-0-1">
            
              安装
            
          </a>

        
          
          <a id="zh-0-2" class="sidebar-link " href="../../single/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/#zh-0-2">
            
              目录结构
            
          </a>

        <strong class="sidebar-section">基础内容</strong>
          
          <a id="zh-1-0" class="sidebar-link " href="../../single/%E8%B7%AF%E7%94%B1/#zh-1-0">
            
              路由
            
          </a>

        
          
          <a id="zh-1-1" class="sidebar-link " href="../../single/%E6%8E%A7%E5%88%B6%E5%99%A8/#zh-1-1">
            
              控制器
            
          </a>

        
          
          <a id="zh-1-2" class="sidebar-link " href="../../single/%E8%AF%B7%E6%B1%82%E9%AA%8C%E8%AF%81%E5%99%A8/#zh-1-2">
            
              请求验证器
            
          </a>

        
          
          <a id="zh-1-3" class="sidebar-link current" href="../../single/%E5%BC%82%E5%B8%B8/#zh-1-3">
            
              异常
            
          </a>

        
          
          <a id="zh-1-4" class="sidebar-link " href="../../single/%E5%93%8D%E5%BA%94/#zh-1-4">
            
              响应
            
          </a>

        <strong class="sidebar-section">前端相关</strong>
          
          <a id="zh-2-0" class="sidebar-link " href="../../single/%E6%A8%A1%E6%9D%BF/#zh-2-0">
            
              模板
            
          </a>

        
          
          <a id="zh-2-1" class="sidebar-link " href="../../single/%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA/#zh-2-1">
            
              前端构建
            
          </a>

        
          
          <a id="zh-2-2" class="sidebar-link " href="../../single/%E6%89%93%E5%8C%85/#zh-2-2">
            
              打包
            
          </a>

        <strong class="sidebar-section">服务介绍</strong>
          
          <a id="zh-3-0" class="sidebar-link " href="../../single/auth-jwt%E6%9C%8D%E5%8A%A1/#zh-3-0">
            
              auth-JWT服务
            
          </a>

        
          
          <a id="zh-3-1" class="sidebar-link " href="../../single/cache-%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1/#zh-3-1">
            
              cache-缓存服务
            
          </a>

        
          
          <a id="zh-3-2" class="sidebar-link " href="../../single/config-%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1/#zh-3-2">
            
              config-配置服务
            
          </a>

        
          
          <a id="zh-3-3" class="sidebar-link " href="../../single/cookie-cookie%E6%9C%8D%E5%8A%A1/#zh-3-3">
            
              cookie-Cookie服务
            
          </a>

        
          
          <a id="zh-3-4" class="sidebar-link " href="../../single/db-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1/#zh-3-4">
            
              db-数据库服务
            
          </a>

        
          
          <a id="zh-3-5" class="sidebar-link " href="../../single/exception-%E5%BC%82%E5%B8%B8%E6%9C%8D%E5%8A%A1/#zh-3-5">
            
              exception-异常服务
            
          </a>

        
          
          <a id="zh-3-6" class="sidebar-link " href="../../single/logger-%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1/#zh-3-6">
            
              logger-日志服务
            
          </a>

        
          
          <a id="zh-3-7" class="sidebar-link " href="../../single/passwd-%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C%E6%9C%8D%E5%8A%A1/#zh-3-7">
            
              passwd-密码哈希服务
            
          </a>

        
          
          <a id="zh-3-8" class="sidebar-link " href="../../single/response-%E5%93%8D%E5%BA%94%E6%9C%8D%E5%8A%A1/#zh-3-8">
            
              response-响应服务
            
          </a>

        
          
          <a id="zh-3-9" class="sidebar-link " href="../../single/route-%E8%B7%AF%E7%94%B1%E6%9C%8D%E5%8A%A1/#zh-3-9">
            
              route-路由服务
            
          </a>

        
          
          <a id="zh-3-10" class="sidebar-link " href="../../single/symcrypt-%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E6%9C%8D%E5%8A%A1/#zh-3-10">
            
              symcrypt-对称加密服务
            
          </a>

        
          
          <a id="zh-3-11" class="sidebar-link " href="../../single/translate-%E7%BF%BB%E8%AF%91%E6%9C%8D%E5%8A%A1/#zh-3-11">
            
              translate-翻译服务
            
          </a>

        
          
          <a id="zh-3-12" class="sidebar-link " href="../../single/upload-%E4%B8%8A%E4%BC%A0%E6%9C%8D%E5%8A%A1/#zh-3-12">
            
              upload-上传服务
            
          </a>

        
          
          <a id="zh-3-13" class="sidebar-link " href="../../single/util-%E5%B7%A5%E5%85%B7%E6%9C%8D%E5%8A%A1/#zh-3-13">
            
              util-工具服务
            
          </a>

        
          
          <a id="zh-3-14" class="sidebar-link " href="../../single/validator-%E9%AA%8C%E8%AF%81%E6%9C%8D%E5%8A%A1/#zh-3-14">
            
              validator-验证服务
            
          </a>

        <strong class="sidebar-section">第三方应用</strong>
          
          <a id="zh-4-0" class="sidebar-link " href="../../single/caddy-web-%E6%9C%8D%E5%8A%A1%E5%99%A8/#zh-4-0">
            
              Caddy Web 服务器
            
          </a>

        
          
          <a id="zh-4-1" class="sidebar-link " href="../../single/%E6%97%A5%E5%BF%97%E6%9F%A5%E7%9C%8B%E5%99%A8/#zh-4-1">
            
              日志查看器
            
          </a>

        
          
          <a id="zh-4-2" class="sidebar-link " href="../../single/%E6%95%B0%E6%8D%AE%E5%BA%93/#zh-4-2">
            
              数据库
            
          </a>

        <strong class="sidebar-section">发布</strong>
          
          <a id="zh-5-0" class="sidebar-link " href="../../single/%E5%8F%91%E5%B8%83%E5%89%8D%E8%A8%80/#zh-5-0">
            
              发布前言
            
          </a>

        
          
          <a id="zh-5-1" class="sidebar-link " href="../../single/%E5%8F%91%E5%B8%83%E5%BC%80%E5%8F%91/#zh-5-1">
            
              发布开发
            
          </a>

        
          
          <a id="zh-5-2" class="sidebar-link " href="../../single/%E5%8F%91%E5%B8%83%E6%B5%8B%E8%AF%95/#zh-5-2">
            
              发布测试
            
          </a>

        
          
          <a id="zh-5-3" class="sidebar-link " href="../../single/%E5%8F%91%E5%B8%83%E7%94%9F%E4%BA%A7/#zh-5-3">
            
              发布生产
            
          </a>

        <strong class="sidebar-section">其他</strong>
          
          <a id="zh-6-0" class="sidebar-link " href="../../single/%E9%85%8D%E7%BD%AE/#zh-6-0">
            
              配置
            
          </a>

        
          
          <a id="zh-6-1" class="sidebar-link " href="../../single/%E6%B5%8B%E8%AF%95/#zh-6-1">
            
              测试
            
          </a>

        
          
          <a id="zh-6-2" class="sidebar-link " href="../../single/%E5%B7%A5%E5%85%B7/#zh-6-2">
            
              工具
            
          </a>

        
          
          <a id="zh-6-3" class="sidebar-link " href="../../single/%E5%91%BD%E4%BB%A4/#zh-6-3">
            
              命令
            
          </a>

        
          
          <a id="zh-6-4" class="sidebar-link " href="../../single/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/#zh-6-4">
            
              高级数据处理
            
          </a>

        
  </div>
</aside>

  
  <main>
    <article id="article">
      <nav id="article-nav">
  <button id="article-nav-menu-btn"><i class="icon icon-menu"></i> On this section</button>
  <button id="article-nav-toc-btn"><i class="icon icon-toc"></i> On this page</button>
</nav>
      <header id="article-header">
  <h1>异常</h1>
</header>
      <div id="article-content">
        
        
        <h2 id="异常服务">异常服务</h2>
<p>异常服务由 <code>services/exception/exception.go</code> 提供.</p>
<p>结构体是 <code>exception.Service</code>.</p>
<p>该结构体实现了 <code>services.ExceptionService</code> 接口.</p>
<h2 id="异常内容异常挂载体">异常内容[异常挂载体]</h2>
<p>主要内容是 <code>app/exceptions</code> 包下的定义.</p>
<p>初始根据 Http 400 状态码定义一些常用的异常方法</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nf">BadRequest</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 400
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">Unauthorized</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 401
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">Forbidden</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 403
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">NotFound</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 404
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">MethodNotAllowed</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 405
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">NotAcceptable</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 406
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">RequestTimeout</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 408
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">RequestEntityTooLarge</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 413
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">RequestURITooLong</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 414
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">UnsupportedMediaType</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 415
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">UnprocessableEntity</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 422
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">TooManyRequests</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="c1">// 429
</span></span></span></code></pre></div><blockquote>
<p>方法名就是状态码的状态文本.</p>
<p>异常内容本质还是 error 接口的实现</p>
</blockquote>
<p>定义这些方法, 本质区别就是返回 json 时, 设置的 code 不一样而已. 这个点也挺重要, 因为前端有时候要根据不同的 code 执行不同的操作.</p>
<h3 id="为什么叫挂载体">为什么叫挂载体</h3>
<p>因为异常服务提供者在注册异常服务的时候, 需要将异常内容绑定到异常服务上, 这样做的目的是把通用复杂以及不怎么修改的方法定义在服务上, 简单常用的方法以及经常修改的方法定义在挂载体上, 这样我们在使用异常服务的时候, 只需要更改 <code>app/exceptions</code> 下的代码就可以了.</p>
<p>下面是提供者的注册代码:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// new一个挂载体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">e</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">exceptions</span><span class="p">.</span><span class="nx">Exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 挂载到异常服务上
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">return</span> <span class="nx">exception</span><span class="p">.</span><span class="nf">Mount</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nf">Init</span><span class="p">(</span><span class="nx">ss</span><span class="o">...</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>重点: 服务提供者实际提供的异常服务是 <code>*exceptions.Exception</code>, 这样做无需修改 <code>services.ExceptionService</code> 接口, 即可使用上面说明的那些 40x 的方法</p>
</blockquote>
<h2 id="如何使用">如何使用</h2>
<h3 id="先说一下使用服务这块">先说一下使用服务这块</h3>
<ul>
<li>调用 app 包的快捷方法</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nf">Exception</span><span class="p">().</span><span class="nf">BadRequest</span><span class="p">(</span><span class="s">&#34;请求失败&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>在 <code>controllers.go</code> 提前声明一个内部变量[推荐]</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">excp</span> <span class="p">=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Exception</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><ul>
<li>不使用快捷方法, 我要自己断言[不建议, 因为服务可能为空]</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">excp</span> <span class="p">=</span> <span class="nx">app</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;exception&#34;</span><span class="p">).(</span><span class="o">*</span><span class="nx">exceptions</span><span class="p">.</span><span class="nx">Exception</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><h3 id="具体使用">具体使用</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">controllers</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;gower/app&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;gower/app/api/requests&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">HelloController</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">app</span><span class="p">.</span><span class="nx">Controller</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">Hello</span> <span class="p">=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">HelloController</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">HelloController</span><span class="p">)</span> <span class="nf">Index</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">requests</span><span class="p">.</span><span class="nx">IndexRequest</span><span class="p">,</span> <span class="nx">user</span> <span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">User</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="nx">any</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">user</span><span class="p">.</span><span class="nx">Name</span> <span class="p">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Name</span>
</span></span><span class="line"><span class="cl">    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">excp</span><span class="p">.</span><span class="nf">BadRequest</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="c1">// 直接返回错误
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;Hello, &#34;</span> <span class="o">+</span> <span class="o">*</span><span class="nx">req</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">Data</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;key&#34;</span><span class="p">:</span> <span class="s">&#34;value&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="关于参数">关于参数</h3>
<p>异常方法实际 new 了一个异常结构体, 然后返回的, 具体看 <code>app/exceptions/exception.go</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// New 创建异常
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Exception</span><span class="p">)</span> <span class="nf">New</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">temp</span> <span class="o">:=</span> <span class="o">*</span><span class="nx">e</span>
</span></span><span class="line"><span class="cl">    <span class="nx">newE</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">temp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">newE</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">exception</span><span class="p">.</span><span class="nf">New</span><span class="p">()).</span>
</span></span><span class="line"><span class="cl">        <span class="nf">Set</span><span class="p">(</span><span class="nx">newE</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">        <span class="nf">Build</span><span class="p">(</span><span class="nx">args</span><span class="o">...</span><span class="p">).</span>
</span></span><span class="line"><span class="cl">        <span class="nf">Set</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>实际参数就是 <code>...any</code>, 在看一个方法:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Set 通用设置内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Exception</span><span class="p">)</span> <span class="nf">Set</span><span class="p">(</span><span class="nx">arg</span> <span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="nx">arg</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="o">*</span><span class="nx">exception</span><span class="p">.</span><span class="nx">Service</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Service</span> <span class="p">=</span> <span class="nx">arg</span><span class="p">.(</span><span class="o">*</span><span class="nx">exception</span><span class="p">.</span><span class="nx">Service</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="o">*</span><span class="nx">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Service</span><span class="p">.</span><span class="nx">Exception</span> <span class="p">=</span> <span class="nx">e</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="kt">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Code</span> <span class="p">=</span> <span class="nx">arg</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="kt">string</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Msg</span> <span class="p">=</span> <span class="nx">arg</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Data</span> <span class="p">=</span> <span class="nx">arg</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">e</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在执行上一个函数的 Build 方法是, for 循环调用了 Set 根据传进来的参数类型来设置 Code, Msg, Data, 异常服务或者是挂载体本身.</p>
<p>这样做的好处就是自由, 下面这些调用都可以</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">excp</span><span class="p">.</span><span class="nf">BadRequest</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">excp</span><span class="p">.</span><span class="nf">BadRequest</span><span class="p">(</span><span class="s">&#34;msg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">excp</span><span class="p">.</span><span class="nf">BadRequest</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="s">&#34;msg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">excp</span><span class="p">.</span><span class="nf">BadRequest</span><span class="p">(</span><span class="s">&#34;msg&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">excp</span><span class="p">.</span><span class="nf">BadRequest</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="s">&#34;msg&#34;</span><span class="p">,</span> <span class="mi">450</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">return</span> <span class="nx">excp</span><span class="p">.</span><span class="nf">BadRequest</span><span class="p">(</span><span class="mi">460</span><span class="p">,</span> <span class="s">&#34;msg&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>注: 如果是多个同类型的参数, 最后面的生效.</p>
</blockquote>
<h2 id="修改异常挂载体">修改异常挂载体</h2>
<h3 id="异常体内容">异常体内容</h3>
<p><code>app/exceptions/exception.go</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Exception 异常响应体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">Exception</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">exception</span><span class="p">.</span><span class="nx">Service</span> <span class="s">`json:&#34;-&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Code</span>               <span class="kt">int</span>    <span class="s">`json:&#34;code&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Msg</span>                <span class="kt">string</span> <span class="s">`json:&#34;msg&#34;`</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Data</span>               <span class="nx">any</span>    <span class="s">`json:&#34;data&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Set 通用设置内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Exception</span><span class="p">)</span> <span class="nf">Set</span><span class="p">(</span><span class="nx">arg</span> <span class="nx">any</span><span class="p">)</span> <span class="nx">services</span><span class="p">.</span><span class="nx">Exception</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="nx">arg</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="o">*</span><span class="nx">exception</span><span class="p">.</span><span class="nx">Service</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Service</span> <span class="p">=</span> <span class="nx">arg</span><span class="p">.(</span><span class="o">*</span><span class="nx">exception</span><span class="p">.</span><span class="nx">Service</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="o">*</span><span class="nx">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Service</span><span class="p">.</span><span class="nx">Exception</span> <span class="p">=</span> <span class="nx">e</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="kt">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Code</span> <span class="p">=</span> <span class="nx">arg</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="kt">string</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Msg</span> <span class="p">=</span> <span class="nx">arg</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">Data</span> <span class="p">=</span> <span class="nx">arg</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">e</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>除了 *exception.Service <code>json:&quot;-&quot;</code> 和前面两个 case 不能修改以外, 你可以调整 Exception 其他参数. 注意增删改这些参数的同时, 要修改 Set 函数, 实现正确处理结构体实例的逻辑. 例如 Msg 改为 Message, 同时 <code>e.Msg = arg.(string)</code> 改为 <code>e.Message = arg.(string)</code></p>
</blockquote>

      </div>
      








  
  
  
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

        
          
        

      
    
        

      
    
        

        
          
        

        
        
      


<footer id="article-footer">
  <time id="article-last-updated" datetime="2024-11-23"><i class="icon icon-calendar"></i>&nbsp;Last updated: 2024-11-23</time>

  
    <a id="article-prev-link" href="../../single/%E8%AF%B7%E6%B1%82%E9%AA%8C%E8%AF%81%E5%99%A8/"><i class="icon icon-prev icon-colored"></i> Prev</a>
  

  
    <a id="article-next-link"  href="../../single/%E5%93%8D%E5%BA%94/">Next <i class="icon icon-next icon-colored"></i></a>
  
</footer>
    </article>
    <aside id="toc">
  <span class="btn-close"><i class="icon icon-close"></i></span>
  <div class="sticky">
    <strong><i class="icon icon-toc"></i> On this page</strong>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#异常服务">异常服务</a></li>
    <li><a href="#异常内容异常挂载体">异常内容[异常挂载体]</a>
      <ul>
        <li><a href="#为什么叫挂载体">为什么叫挂载体</a></li>
      </ul>
    </li>
    <li><a href="#如何使用">如何使用</a>
      <ul>
        <li><a href="#先说一下使用服务这块">先说一下使用服务这块</a></li>
        <li><a href="#具体使用">具体使用</a></li>
        <li><a href="#关于参数">关于参数</a></li>
      </ul>
    </li>
    <li><a href="#修改异常挂载体">修改异常挂载体</a>
      <ul>
        <li><a href="#异常体内容">异常体内容</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</aside>
  </main>
</div>

    <footer id="site-footer">
  
  <div id="site-footer-copyright">
    <a href="https://falling-ts.github.io" target="_blank">
      <i class="icon icon-copyright"></i> 2024 falling-ts
    </a>
  </div>

  
  <div id="site-footer-social">

    

    

    

    

  </div>

  
  <div id="site-footer-fund">

    

    

  </div>

  
  <div id="site-footer-love">
    Made with <i class="icon icon-love icon-colored"></i> &nbsp;from&nbsp;<a href="https://docura.github.io/" target="_blank">Docura</a>
  </div>
</footer>
    






<script type="text/javascript" src="../../js/base.min.js"></script>




<script type="application/javascript">
    if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js?2024-11-24')
            .catch(function(err) {console.error('ServiceWorker registration failed: ', err);});
    }
</script>
  </body>
</html>